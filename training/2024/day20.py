import numpy as np
from collections import deque
from tqdm import tqdm
import time

example = """
###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############
"""

actual = """#############################################################################################################################################
#.......#.....#.......#.....#...#.......###...###...###...#...#...###...#...............###...###...........#.............#...#.....#.....###
#.#####.#.###.#.#####.#.###.#.#.#.#####.###.#.###.#.###.#.#.#.#.#.###.#.#.#############.###.#.###.#########.#.###########.#.#.#.###.#.###.###
#.....#.#...#.#.....#.#.#...#.#.#.....#.#...#.#...#.....#...#...#...#.#.#.#...#.........#...#.#...#.........#.......#.....#.#...#...#...#...#
#####.#.###.#.#####.#.#.#.###.#.#####.#.#.###.#.###################.#.#.#.#.#.#.#########.###.#.###.###############.#.#####.#####.#####.###.#
#.....#...#.#.###...#...#...#.#.#.....#.#...#.#...........#.........#.#.#...#.#.#...#...#...#...#...#.......#...###.#...#...#.....#...#.#...#
#.#######.#.#.###.#########.#.#.#.#####.###.#.###########.#.#########.#.#####.#.#.#.#.#.###.#####.###.#####.#.#.###.###.#.###.#####.#.#.#.###
#.#.....#...#...#.........#.#.#.#.....#...#.#.#.....###...#...#...#...#.###...#...#...#...#.....#.###.....#...#...#.#...#.#...#...#.#...#...#
#.#.###.#######.#########.#.#.#.#####.###.#.#.#.###.###.#####.#.#.#.###.###.#############.#####.#.#######.#######.#.#.###.#.###.#.#.#######.#
#...###.....#...###...###.#.#.#.#...#...#...#...#...#...#.....#.#...#...#...#.............###...#.....###.......#.#.#.#...#...#.#...#.......#
###########.#.#####.#.###.#.#.#.#.#.###.#########.###.###.#####.#####.###.###.###############.#######.#########.#.#.#.#.#####.#.#####.#######
#.......###.#.###...#...#.#...#...#.###.........#...#...#.....#.#...#.....#...#...###.........#.......#...###...#...#.#.#...#...#...#.#.....#
#.#####.###.#.###.#####.#.#########.###########.###.###.#####.#.#.#.#######.###.#.###.#########.#######.#.###.#######.#.#.#.#####.#.#.#.###.#
#.....#.....#...#.....#.#.#.........#...#...#...#...#...#.....#.#.#.....#...#...#...#.........#.....#...#...#...#.....#.#.#.......#...#.#...#
#####.#########.#####.#.#.#.#########.#.#.#.#.###.###.###.#####.#.#####.#.###.#####.#########.#####.#.#####.###.#.#####.#.#############.#.###
#...#.......#...#...#.#.#.#.###...#...#...#...#...#...#...#...#...#.....#...#.....#.....###...#.....#.....#...#.#.......#.........#...#.#...#
#.#.#######.#.###.#.#.#.#.#.###.#.#.###########.###.###.###.#.#####.#######.#####.#####.###.###.#########.###.#.#################.#.#.#.###.#
#.#...###...#...#.#...#...#...#.#.#.........#...###.#...#...#.....#...#.....#...#.#.....#...#...###...###...#.#.#.................#.#.#.#...#
#.###.###.#####.#.###########.#.#.#########.#.#####.#.###.#######.###.#.#####.#.#.#.#####.###.#####.#.#####.#.#.#.#################.#.#.#.###
#...#...#...#...#...........#.#.#.#...#...#.#.#...#.#.....#.......#...#...#...#.#.#.....#...#.#...#.#...#...#.#.#...............###.#...#...#
###.###.###.#.#############.#.#.#.#.#.#.#.#.#.#.#.#.#######.#######.#####.#.###.#.#####.###.#.#.#.#.###.#.###.#.###############.###.#######.#
###...#.....#...#...###...#.#.#.#...#...#.#.#.#.#.#.#...#...#.....#.....#...#...#...#...#...#...#.#...#...#...#.#.........#...#.....#.......#
#####.#########.#.#.###.#.#.#.#.#########.#.#.#.#.#.#.#.#.###.###.#####.#####.#####.#.###.#######.###.#####.###.#.#######.#.#.#######.#######
#...#.......#...#.#...#.#.#.#.#.........#.#.#...#.#.#.#...###...#.....#.....#.....#.#...#...#.....###.....#.###.#.#.....#...#.......#.#...###
#.#.#######.#.###.###.#.#.#.#.#########.#.#.#####.#.#.#########.#####.#####.#####.#.###.###.#.###########.#.###.#.#.###.###########.#.#.#.###
#.#.#...#...#...#...#.#.#.#.#.###.......#.#.....#...#.......###.....#...#...#.....#...#.###.#.#...###...#.#.....#.#.#...###...#...#...#.#...#
#.#.#.#.#.#####.###.#.#.#.#.#.###.#######.#####.###########.#######.###.#.###.#######.#.###.#.#.#.###.#.#.#######.#.#.#####.#.#.#.#####.###.#
#.#...#.#.....#.....#...#...#...#.......#.....#...#.........#.......#...#...#.......#.#.#...#.#.#...#.#.#.#.......#.#.....#.#.#.#.....#...#.#
#.#####.#####.#################.#######.#####.###.#.#########.#######.#####.#######.#.#.#.###.#.###.#.#.#.#.#######.#####.#.#.#.#####.###.#.#
#.....#.#...#.................#.###...#.#.....#...#.........#...#...#...#...#.......#.#...#...#...#.#.#.#.#.#.......#.....#.#.#.#.....#...#.#
#####.#.#.#.#################.#.###.#.#.#.#####.###########.###.#.#.###.#.###.#######.#####.#####.#.#.#.#.#.#.#######.#####.#.#.#.#####.###.#
#...#.#...#.....#.............#...#.#.#.#.#...#.....#.......###...#...#.#.#...#.....#.....#.#...#.#...#...#...#.....#.....#.#.#.#.#...#...#.#
#.#.#.#########.#.###############.#.#.#.#.#.#.#####.#.###############.#.#.#.###.###.#####.#.#.#.#.#############.###.#####.#.#.#.#.#.#.###.#.#
#.#.#.........#.#.............#...#.#.#.#.#.#.#...#.#.#...###...#...#.#.#.#.###...#.#...#.#.#.#.#.....#.........###.#.....#.#.#.#.#.#.#...#.#
#.#.#########.#.#############.#.###.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#####.#.#.#.#.#.#.#.#####.#.###########.#.#####.#.#.#.#.#.#.###.#
#.#...#.......#...............#.....#.#.#.#.#.#.#.#.#.#.#...#.#.#.#.#.#...#...#...#.#.#.#.#.#.#...#...#...#...#...#...#...#.#.#.#...#...#...#
#.###.#.#############################.#.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#######.#.###.#.#.#.#.#.###.#.#####.#.#.#.#.#####.#.#.#.#.#########.###
#...#.#.........#.....#.....#.......#...#.#.#.#.#...#.#.#...#.#.#.#.#.#...#...#...#.#.#.#.#.#.#...#...###...#.#.#.###...#...#...#...#...#...#
###.#.#########.#.###.#.###.#.#####.#####.#.#.#.#####.#.#.###.#.#.#.#.#.#.#.#####.#.#.#.#.#.#.#.#####.#######.#.#.###.###########.#.#.#.###.#
#...#.###...#...#.#...#...#...#.....#.....#.#.#.....#...#...#.#...#.#...#.#...#...#...#...#.#.#.......#.......#.#.....#.......#...#...#.....#
#.###.###.#.#.###.#.#####.#####.#####.#####.#.#####.#######.#.#####.#####.###.#.###########.#.#########.#######.#######.#####.#.#############
#...#.....#...#...#.#...#.#.....#...#.....#.#.#...#...#.....#.#.....#...#.#...#.........#...#.#.......#.........#.....#.....#.#.#.....#.....#
###.###########.###.#.#.#.#.#####.#.#####.#.#.#.#.###.#.#####.#.#####.#.#.#.###########.#.###.#.#####.###########.###.#####.#.#.#.###.#.###.#
###...#...#...#...#...#...#...#...#.....#.#.#.#.#.#...#...#...#.....#.#.#.#...#...#...#.#...#.#...#...###...#.....###...#...#.#...#...#.#...#
#####.#.#.#.#.###.###########.#.#######.#.#.#.#.#.#.#####.#.#######.#.#.#.###.#.#.#.#.#.###.#.###.#.#####.#.#.#########.#.###.#####.###.#.###
#...#.#.#.#.#.#...#.........#...#.......#...#.#.#.#.....#.#.#.......#.#.#...#.#.#.#.#.#.###...#...#.......#.#.........#.#.#...#...#.....#...#
#.#.#.#.#.#.#.#.###.#######.#####.###########.#.#.#####.#.#.#.#######.#.###.#.#.#.#.#.#.#######.###########.#########.#.#.#.###.#.#########.#
#.#.#...#...#...###.......#.#...#...........#.#.#.#...#.#.#.#...#...#.#.....#...#.#.#.#.#.....#.#.....#...#.#.........#...#.#...#.#...#...#.#
#.#.#####################.#.#.#.###########.#.#.#.#.#.#.#.#.###.#.#.#.###########.#.#.#.#.###.#.#.###.#.#.#.#.#############.#.###.#.#.#.#.#.#
#.#.#...###...............#...#...#.......#.#.#.#.#.#.#.#...#...#.#.#.....###...#...#...#...#...#.#...#.#.#.#.............#.#.###...#.#.#...#
#.#.#.#.###.#####################.#.#####.#.#.#.#.#.#.#.#####.###.#.#####.###.#.###########.#####.#.###.#.#.#############.#.#.#######.#.#####
#.#...#...#.....................#.#.....#...#...#.#.#.#.....#.....#.....#.....#.#...........#.....#.....#.#...............#.#.......#.#...###
#.#######.#####################.#.#####.#########.#.#.#####.###########.#######.#.###########.###########.#################.#######.#.###.###
#.......#.###...#.........#.....#.....#...#...###...#.#...#.#...#.......#.....#.#.#...........#.......#...#...............#.........#...#...#
#######.#.###.#.#.#######.#.#########.###.#.#.#######.#.#.#.#.#.#.#######.###.#.#.#.###########.#####.#.###.#############.#############.###.#
#.......#.....#.#.......#...#.......#.#...#.#.#...###...#.#...#.#.....#...#...#.#...#...#...###.....#.#.....#...#.........#...###...###...#.#
#.#############.#######.#####.#####.#.#.###.#.#.#.#######.#####.#####.#.###.###.#####.#.#.#.#######.#.#######.#.#.#########.#.###.#.#####.#.#
#.............#.........#...#.#.....#.#.....#...#.......#.#...#.#.....#...#...#.#...#.#...#.........#.........#...#.....#...#.....#.....#.#.#
#############.###########.#.#.#.#####.#################.#.#.#.#.#.#######.###.#.#.#.#.#############################.###.#.#############.#.#.#
#...........#.....#.....#.#...#.#...#...........#...#...#...#.#.#.#...#...###...#.#.#.....#...#...#...#.........###...#.#.#.............#.#.#
#.#########.#####.#.###.#.#####.#.#.###########.#.#.#.#######.#.#.#.#.#.#########.#.#####.#.#.#.#.#.#.#.#######.#####.#.#.#.#############.#.#
#...#.....#...###.#.###...#...#...#...#...#...#.#.#.#.....#...#.#.#.#.#...#...#...#.....#...#...#...#...#.....#.#.....#...#.............#...#
###.#.###.###.###.#.#######.#.#######.#.#.#.#.#.#.#.#####.#.###.#.#.#.###.#.#.#.#######.#################.###.#.#.#####################.#####
#...#.###...#.#...#...###...#.........#.#...#.#...#...#...#.#...#.#.#...#.#.#...#.....#...###...#.....###...#.#.#.#.........#...........#...#
#.###.#####.#.#.#####.###.#############.#####.#######.#.###.#.###.#.###.#.#.#####.###.###.###.#.#.###.#####.#.#.#.#.#######.#.###########.#.#
#.....#.....#...#.....#...#.............#...#.......#.#.###...#...#...#.#.#.....#.###...#.....#.#...#.......#...#.#.#...###...#...###...#.#.#
#######.#########.#####.###.#############.#.#######.#.#.#######.#####.#.#.#####.#.#####.#######.###.#############.#.#.#.#######.#.###.#.#.#.#
#...###...........#.....#...#.............#...#.....#...#...###.......#...#...#...#...#.......#.....#.....#...#...#...#.......#.#.#...#...#.#
#.#.###############.#####.###.###############.#.#########.#.###############.#.#####.#.#######.#######.###.#.#.#.#############.#.#.#.#######.#
#.#.................#...#.#...#.............#...#...###...#.....#.........#.#.#...#.#.#...###.......#.#...#.#.#.#.............#.#.#...#.....#
#.###################.#.#.#.###.###########.#####.#.###.#######.#.#######.#.#.#.#.#.#.#.#.#########.#.#.###.#.#.#.#############.#.###.#.#####
#.#...........#...#...#.#.#...#.#...........#.....#.....#.......#.......#...#...#...#...#.....#...#...#.....#...#.#...#.......#.#.###.#.....#
#.#.#########.#.#.#.###.#.###.#.#.###########.###########.#############.#####################.#.#.###############.#.#.#.#####.#.#.###.#####.#
#...#.........#.#.#.###...###...#.............#.....#.....#.....###...#.....................#...#.....#.....#...#...#...#.....#.#.....#.....#
#####.#########.#.#.###########################.###.#.#####.###.###.#.#####################.#########.#.###.#.#.#########.#####.#######.#####
#...#.......#...#.#.#...#...###...#...........#...#...#.....#...#...#...#...................#.......#.#...#...#...#...#...#...#...#.....#...#
#.#.#######.#.###.#.#.#.#.#.###.#.#.#########.###.#####.#####.###.#####.#.###################.#####.#.###.#######.#.#.#.###.#.###.#.#####.#.#
#.#.###...#...###...#.#...#...#.#...#...#...#.....###...#...#.....#.....#...........#...#...#.#.....#...#.......#...#...#...#...#.#.......#.#
#.#.###.#.###########.#######.#.#####.#.#.#.#########.###.#.#######.###############.#.#.#.#.#.#.#######.#######.#########.#####.#.#########.#
#.#.#...#.....#...###.....#...#.......#...#.....#...#.#...#.........###.............#.#.#.#...#.......#.......#.###...#...#.....#.#.......#.#
#.#.#.#######.#.#.#######.#.###################.#.#.#.#.###############.#############.#.#.###########.#######.#.###.#.#.###.#####.#.#####.#.#
#.#.#.....#...#.#.....#...#.....#.......#.......#.#.#.#.#.........#...#...........#...#...###...#...#.#.....#.#...#.#.#.#...#...#.#.....#...#
#.#.#####.#.###.#####.#.#######.#.#####.#.#######.#.#.#.#.#######.#.#.###########.#.#########.#.#.#.#.#.###.#.###.#.#.#.#.###.#.#.#####.#####
#.#.....#.#.###.....#...#.....#.#...###...#...###.#...#.#.#.......#.#.###.....###...#.........#...#.#...#...#.....#.#.#.#.....#...#.....#...#
#.#####.#.#.#######.#####.###.#.###.#######.#.###.#####.#.#.#######.#.###.###.#######.#############.#####.#########.#.#.###########.#####.#.#
#...#...#.#...#...#.......###.#...#.........#...#.#...#.#.#.....#...#...#.#...#...###.......#.....#.......#...###...#...#...#...#...###...#.#
###.#.###.###.#.#.###########.###.#############.#.#.#.#.#.#####.#.#####.#.#.###.#.#########.#.###.#########.#.###.#######.#.#.#.#.#####.###.#
#...#...#.#...#.#.........#...#...#.......#...#...#.#...#...#...#.#.....#.#.###.#.#######S#...#...#.........#.....#...#...#...#.#.....#...#.#
#.#####.#.#.###.#########.#.###.###.#####.#.#.#####.#######.#.###.#.#####.#.###.#.#######.#####.###.###############.#.#.#######.#####.###.#.#
#.#...#...#...#.........#.#...#.....#...#...#.......###.....#.#...#.#.....#.#...#.#######.#.....#...#.........#.....#.#.#...###.....#.....#.#
#.#.#.#######.#########.#.###.#######.#.###############.#####.#.###.#.#####.#.###.#######.#.#####.###.#######.#.#####.#.#.#.#######.#######.#
#.#.#.#...#...#...#...#.#.....#.......#.....#...#.....#...#...#...#.#...#...#...#.#######.#.......###.....###...###...#...#...#...#.......#.#
#.#.#.#.#.#.###.#.#.#.#.#######.###########.#.#.#.###.###.#.#####.#.###.#.#####.#.#######.###############.#########.#########.#.#.#######.#.#
#.#.#...#.#.....#.#.#.#.#...#...#...........#.#.#.#...###.#.#...#.#...#.#.#...#.#.#######...###.......###.........#...#.....#...#...#...#...#
#.#.#####.#######.#.#.#.#.#.#.###.###########.#.#.#.#####.#.#.#.#.###.#.#.#.#.#.#.#########.###.#####.###########.###.#.###.#######.#.#.#####
#.#.#.....#.....#...#...#.#.#.###...#...###...#.#.#.#...#.#.#.#.#...#.#.#.#.#.#.#.#########...#.....#.............###...#...#.....#...#.....#
#.#.#.#####.###.#########.#.#.#####.#.#.###.###.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.###########.#####.#####################.###.###.#########.#
#...#.#...#.#...#.....#...#.#.#...#...#.....#...#.#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#########...###...#.................###.#...###.#.........#
#####.#.#.#.#.###.###.#.###.#.#.#.###########.###.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#########.#####.###.###############.###.#.#####.#.#########
#.....#.#.#.#...#...#.#...#...#.#.#...#.....#...#.#.#.#.#.#.#...#.#.#.#.#.#.#.#.#.#########.....#...#.#.............#...#...###...#.........#
#.#####.#.#.###.###.#.###.#####.#.#.#.#.###.###.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#.#############.###.#.#.###########.###.#######.###########.#
#.#...#.#.#...#...#.#.#...#.....#...#...###.....#.#...#.#.#.#...#.#.#.#.#.#.#...#.#########.....###...#...........#...#.......#...#...#...#.#
#.#.#.#.#.###.###.#.#.#.###.#####################.#####.#.#.#.###.#.#.#.#.#.#####.#########.#####################.###.#######.###.#.#.#.#.#.#
#.#.#.#.#.#...###...#...###...#.....#...#...#...#...#...#.#.#.#...#.#.#.#.#.#.....#########.###...###...#.........###.......#...#.#.#...#...#
#.#.#.#.#.#.#################.#.###.#.#.#.#.#.#.###.#.###.#.#.#.###.#.#.#.#.#.#############.###.#.###.#.#.#################.###.#.#.#########
#.#.#...#...#.......###...#...#.###...#.#.#.#.#.#...#.#...#.#.#.#...#.#.#.#.#.#.....#######...#.#...#.#.#.......#.....#...#.#...#.#.........#
#.#.#########.#####.###.#.#.###.#######.#.#.#.#.#.###.#.###.#.#.#.###.#.#.#.#.#.###.#########.#.###.#.#.#######.#.###.#.#.#.#.###.#########.#
#...###...#...#...#...#.#.#.....#.......#.#.#.#.#.#...#...#.#.#...#...#.#.#.#.#.#...#########...#...#.#...#...#...#...#.#.#...###...........#
#######.#.#.###.#.###.#.#.#######.#######.#.#.#.#.#.#####.#.#.#####.###.#.#.#.#.#.###############.###.###.#.#.#####.###.#.###################
#.......#...#...#...#...#.......#.......#.#.#.#.#.#...#...#.#.....#...#.#.#.#...#...#######.......#...###.#.#.#...#...#.#.............#...###
#.###########.#####.###########.#######.#.#.#.#.#.###.#.###.#####.###.#.#.#.#######.#######.#######.#####.#.#.#.#.###.#.#############.#.#.###
#.......#...#...###...#...#...#.......#.#.#.#.#.#...#.#.###.#.....###...#.#.......#.#E#####.#...#...#.....#.#.#.#...#...#.....#.....#...#...#
#######.#.#.###.#####.#.#.#.#.#######.#.#.#.#.#.###.#.#.###.#.###########.#######.#.#.#####.#.#.#.###.#####.#.#.###.#####.###.#.###.#######.#
#.......#.#...#.#.....#.#...#...#...#...#.#.#.#.....#.#...#...#...........#.......#.#.#####.#.#.#.###...#...#.#.###...#...###...#...#...#...#
#.#######.###.#.#.#####.#######.#.#.#####.#.#.#######.###.#####.###########.#######.#.#####.#.#.#.#####.#.###.#.#####.#.#########.###.#.#.###
#.#...#...#...#.#.......#...###...#.#...#.#.#.......#.#...#...#...........#.......#.#...###...#.#...#...#...#.#...#...#.........#...#.#.#...#
#.#.#.#.###.###.#########.#.#######.#.#.#.#.#######.#.#.###.#.###########.#######.#.###.#######.###.#.#####.#.###.#.###########.###.#.#.###.#
#.#.#.#.###...#.#.....#...#.........#.#.#.#.#.......#.#.....#.#...........#...#...#...#.......#.#...#.#...#.#.#...#.#.....#...#...#...#.#...#
#.#.#.#.#####.#.#.###.#.#############.#.#.#.#.#######.#######.#.###########.#.#.#####.#######.#.#.###.#.#.#.#.#.###.#.###.#.#.###.#####.#.###
#.#.#...#...#...#...#.#...#.......#...#.#.#.#.......#...#.....#.........#...#.#.#####.#.......#...#...#.#.#.#.#.#...#...#.#.#...#...#...#.###
#.#.#####.#.#######.#.###.#.#####.#.###.#.#.#######.###.#.#############.#.###.#.#####.#.###########.###.#.#.#.#.#.#####.#.#.###.###.#.###.###
#.#...#...#.###.....#.....#.#.....#.#...#.#.#...#...#...#...#...........#.###.#...#...#.......#.....#...#.#.#.#.#...#...#.#.#...#...#...#...#
#.###.#.###.###.###########.#.#####.#.###.#.#.#.#.###.#####.#.###########.###.###.#.#########.#.#####.###.#.#.#.###.#.###.#.#.###.#####.###.#
#.#...#...#.#...#.......#...#.#...#.#...#.#...#.#...#.#...#.#.....#...#...#...#...#...#...#...#.#...#...#.#.#.#.###.#.###...#...#.###...#...#
#.#.#####.#.#.###.#####.#.###.#.#.#.###.#.#####.###.#.#.#.#.#####.#.#.#.###.###.#####.#.#.#.###.#.#.###.#.#.#.#.###.#.#########.#.###.###.###
#...#.....#.#.....#.....#.#...#.#.#.#...#...#...#...#.#.#.#.#.....#.#.#...#.#...###...#.#.#.#...#.#.#...#.#.#.#...#.#.....#.....#...#...#...#
#####.#####.#######.#####.#.###.#.#.#.#####.#.###.###.#.#.#.#.#####.#.###.#.#.#####.###.#.#.#.###.#.#.###.#.#.###.#.#####.#.#######.###.###.#
#.....#...#...###...#...#.#.#...#...#...#...#.....###.#.#.#.#.#.....#.#...#.#.#...#.....#.#.#.#...#.#.###.#.#.#...#.#.....#...#...#...#.....#
#.#####.#.###.###.###.#.#.#.#.#########.#.###########.#.#.#.#.#.#####.#.###.#.#.#.#######.#.#.#.###.#.###.#.#.#.###.#.#######.#.#.###.#######
#.......#...#.#...#...#.#.#.#...#.....#.#.###...#...#.#.#.#.#.#...#...#.#...#...#...#...#.#.#.#.#...#...#.#.#...#...#.....#...#.#...#.......#
###########.#.#.###.###.#.#.###.#.###.#.#.###.#.#.#.#.#.#.#.#.###.#.###.#.#########.#.#.#.#.#.#.#.#####.#.#.#####.#######.#.###.###.#######.#
#...........#...#...#...#.#.....#...#...#.....#...#.#...#.#.#...#.#...#.#.#...#...#...#.#...#...#.#...#.#.#.....#...#.....#...#...#.#.....#.#
#.###############.###.###.#########.###############.#####.#.###.#.###.#.#.#.#.#.#.#####.#########.#.#.#.#.#####.###.#.#######.###.#.#.###.#.#
#.#.............#...#...#.#.......#.#...#.....#...#...###...###...###...#.#.#...#.#...#...###...#...#.#.#...#...#...#.......#...#.#...#...#.#
#.#.###########.###.###.#.#.#####.#.#.#.#.###.#.#.###.###################.#.#####.#.#.###.###.#.#####.#.###.#.###.#########.###.#.#####.###.#
#...#...#.......#...###.#.#.#...#...#.#...###.#.#...#.....#...#...#...###.#.....#.#.#...#.#...#.....#.#.#...#...#...#.......###.#.....#...#.#
#####.#.#.#######.#####.#.#.#.#.#####.#######.#.###.#####.#.#.#.#.#.#.###.#####.#.#.###.#.#.#######.#.#.#.#####.###.#.#########.#####.###.#.#
#.....#...#...#...#.....#.#.#.#.#...#.....#...#.#...#...#.#.#...#...#.....#...#.#.#.#...#...#.....#.#.#.#...#...#...#.......#...#...#...#.#.#
#.#########.#.#.###.#####.#.#.#.#.#.#####.#.###.#.###.#.#.#.###############.#.#.#.#.#.#######.###.#.#.#.###.#.###.#########.#.###.#.###.#.#.#
#...........#...###.......#...#...#.......#.....#.....#...#.................#...#...#.........###...#...###...###...........#.....#.....#...#
#############################################################################################################################################
"""


def get_best_path(
    grid: np.ndarray,
    start_pos: tuple[int, int],
    end_pos: tuple[int, int],
) -> list[tuple[int, int]]:
    nb_rows, nb_cols = grid.shape
    curr_score = 0
    queue: deque = deque([])
    queue.append(([start_pos], curr_score))
    seen_pos = set()
    current_best_score = float("inf")
    best_path = []
    while queue:
        curr_path, curr_score = queue.popleft()
        curr_pos = curr_path[-1]
        if curr_pos in seen_pos:  # seen pos during this specific grid solving
            continue

        # and therefore should be counted
        if curr_score >= current_best_score:
            seen_pos.add(curr_pos)
            continue
        if curr_pos == end_pos and curr_score < current_best_score:
            current_best_score = curr_score
            best_path = curr_path
            # print(f"new best: {current_lowest_score}")
            continue
        seen_pos.add(curr_pos)
        for offset in (-1, 0), (1, 0), (0, 1), (0, -1):
            new_pos = curr_pos[0] + offset[0], curr_pos[1] + offset[1]
            if (
                0 <= new_pos[0] < nb_rows
                and 0 <= new_pos[1] < nb_cols
                and grid[new_pos] == "."
            ):
                queue.append((curr_path + [new_pos], curr_score + 1))
    # print(reference_times)
    return best_path


def make_grid_get_data(
    inp: str,
) -> tuple[np.ndarray, tuple[int, int], tuple[int, int]]:
    """Builds the initial grid and return start_pos, end_pos, and the locations of hash tags"""
    grid = np.array([list(line) for line in inp.strip().splitlines()], dtype=str)
    nb_rows, nb_cols = grid.shape
    start_pos = end_pos = None
    for r in range(nb_rows):
        for c in range(nb_cols):
            if grid[r, c] == "S":
                start_pos = (r, c)
                grid[start_pos] = "."
            elif grid[r, c] == "E":
                end_pos = (r, c)
                grid[end_pos] = "."

    assert (start_pos is not None) and (end_pos is not None)
    assert np.unique(grid).tolist() == ["#", "."]
    return grid, start_pos, end_pos


def solve_p1(inp: str, picoseconds_delta: int) -> int:
    starttime = time.time()
    grid, start_pos, end_pos = make_grid_get_data(inp)
    best_path = get_best_path(grid, start_pos, end_pos)
    nb_rows, nb_cols = grid.shape

    candidate_walls = set()
    ans = 0
    for coord_ind, (x, y) in enumerate(best_path):
        neigh = (x + 1, y)
        if (
            neigh not in candidate_walls
            and 0 <= x + 2 < nb_rows
            and grid[neigh] == "#"
            and (x + 2, y) in best_path
            and (ind := best_path.index((x + 2, y))) > coord_ind
        ):  # at time 2 of the cheat we need to fall back on a dot
            candidate_walls.add(neigh)
            ans += 1 if ind - coord_ind > picoseconds_delta else 0

        neigh = (x - 1, y)
        if (
            neigh not in candidate_walls
            and 0 <= x - 2 < nb_rows
            and grid[neigh] == "#"
            and (x - 2, y) in best_path
            and (ind := best_path.index((x - 2, y))) > coord_ind
        ):  # at time 2 of the cheat we need to fall back on a dot
            candidate_walls.add(neigh)
            ans += 1 if ind - coord_ind > picoseconds_delta else 0
        neigh = (x, y - 1)
        if (
            neigh not in candidate_walls
            and 0 <= y - 2 < nb_cols
            and grid[neigh] == "#"
            and (x, y - 2) in best_path
            and (ind := best_path.index((x, y - 2))) > coord_ind
        ):  # at time 2 of the cheat we need to fall back on a dot
            candidate_walls.add(neigh)
            ans += 1 if ind - coord_ind > picoseconds_delta else 0
        neigh = (x, y + 1)
        if (
            neigh not in candidate_walls
            and 0 <= y + 2 < nb_cols
            and grid[neigh] == "#"
            and (x, y + 2) in best_path
            and (ind := best_path.index((x, y + 2))) > coord_ind
        ):  # at time 2 of the cheat we need to fall back on a dot
            candidate_walls.add(neigh)
            ans += 1 if ind - coord_ind > picoseconds_delta else 0

    print(f"Part 1: {ans} in {round(time.time()-starttime, 2)}s")
    return ans


if __name__ == "__main__":
    assert solve_p1(example, picoseconds_delta=2) == 44
    assert solve_p1(example, picoseconds_delta=38) == 3
    assert solve_p1(actual, picoseconds_delta=100) == 1317
